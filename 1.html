<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>工时薪资计算系统</title>
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- 引入 Inter 字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- 自定义 Tailwind 配置（可选） -->
    <script>
        tailwind.config = {
            darkMode: 'class', // 启用类名控制的深色模式
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif']
                    },
                    colors: {
                        'muted-purple': '#9d84b7',
                        'muted-teal': '#6ca9a1',
                        'muted-pink': '#c792a6',
                        'muted-amber': '#e6af7e'
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen bg-gradient-to-br from-purple-50 via-gray-50 to-purple-100 py-3 px-2 font-sans antialiased transition-colors duration-300">

    <div class="max-w-6xl mx-auto">

        <!-- 基础信息卡片 -->
        <div class="bg-white rounded-xl shadow-lg p-2 mb-2 border border-gray-100 dark:bg-black dark:border-gray-700 dark:text-gray-300">
            <h2 class="text-2xl font-semibold text-gray-800 mb-2 flex items-center dark:text-gray-300">
                <svg class="w-6 h-6 mr-2 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
                </svg>
                基础信息
            </h2>
            <div class="space-y-2">
                <div class="grid grid-cols-3 gap-2">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-400">底薪 (元)</label>
                        <input type="number" id="baseSalary" value="2600" onchange="calculate()" class="w-full px-3 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-400">正班天数</label>
                        <input type="number" id="regularDays" value="19" onchange="calculate()" class="w-full px-3 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-400">工价 (元/小时)</label>
                        <input type="number" id="workPrice" value="23" step="0.01" onchange="calculate()" class="w-full px-3 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300">
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-400">时薪 (元/小时)</label>
                        <input type="text" id="hourlyRate" readonly class="w-full px-3 py-1 border border-gray-300 rounded-lg bg-gray-100 text-gray-700 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-400">总工时 (小时)</label>
                        <input type="text" id="workHours" readonly class="w-full px-3 py-1 border border-gray-300 rounded-lg bg-gray-100 text-gray-700 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300">
                    </div>
                </div>
            </div>
        </div>

        <!-- 加班信息卡片 -->
        <div class="bg-white rounded-xl shadow-lg p-2 mb-2 border border-gray-100 dark:bg-black dark:border-gray-700 dark:text-gray-300">
            <h2 class="text-2xl font-semibold text-gray-800 mb-2 flex items-center dark:text-gray-300">
                <svg class="w-6 h-6 mr-2 text-emerald-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
                加班信息
            </h2>
            <div class="space-y-2">
                <div class="grid grid-cols-3 gap-2">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-400">G1 (元/小时)</label>
                        <input type="text" id="g1Rate" readonly class="w-full px-3 py-1 border border-gray-300 rounded-lg bg-gray-100 text-gray-700 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-400">工时 (小时)</label>
                        <input type="number" id="g1Hours" value="40" onchange="calculate()" class="w-full px-3 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-400">薪资 (元)</label>
                        <input type="text" id="g1Pay" readonly class="w-full px-3 py-1 border border-gray-300 rounded-lg bg-gray-100 text-gray-700 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300">
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-400">G2 (元/小时)</label>
                        <input type="text" id="g2Rate" readonly class="w-full px-3 py-1 border border-gray-300 rounded-lg bg-gray-100 text-gray-700 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-400">工时 (小时)</label>
                        <input type="number" id="g2Hours" value="40" onchange="calculate()" class="w-full px-3 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-400">薪资 (元)</label>
                        <input type="text" id="g2Pay" readonly class="w-full px-3 py-1 border border-gray-300 rounded-lg bg-gray-100 text-gray-700 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300">
                    </div>
                </div>
                <div class="grid grid-cols-3 gap-2">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-400">G3 (元/小时)</label>
                        <input type="text" id="g3Rate" readonly class="w-full px-3 py-1 border border-gray-300 rounded-lg bg-gray-100 text-gray-700 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-400">工时 (小时)</label>
                        <input type="number" id="g3Hours" value="0" onchange="calculate()" class="w-full px-3 py-1 border border-gray-300 rounded-lg focus:ring-2 focus:ring-emerald-500 focus:border-transparent dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1 dark:text-gray-400">薪资 (元)</label>
                        <input type="text" id="g3Pay" readonly class="w-full px-3 py-1 border border-gray-300 rounded-lg bg-gray-100 text-gray-700 dark:bg-gray-800 dark:border-gray-600 dark:text-gray-300">
                    </div>
                </div>
            </div>
        </div>

        <!-- 计算结果与图表 -->
        <div class="bg-white rounded-xl shadow-lg p-2 dark:bg-black dark:border-gray-700 dark:text-gray-300">

            <!-- 计算结果 -->
            <div class="bg-white rounded-xl p-2 border border-gray-100 dark:bg-black dark:border-gray-700 dark:text-gray-300">
                <h2 class="text-2xl font-semibold text-gray-800 mb-2 flex items-center dark:text-gray-300">
                    <svg class="w-6 h-6 mr-2 text-violet-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"></path>
                    </svg>
                    计算结果
                </h2>
                <div class="space-y-2">
                    <div class="bg-purple-50 rounded-lg p-2 border-l-4 border-purple-500 dark:bg-gray-800 dark:border-purple-500">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700 font-medium dark:text-gray-400">加班薪资</span>
                            <span class="text-2xl font-bold text-purple-600 dark:text-purple-400" id="overtimePay">0 元</span>
                        </div>
                    </div>
                    <div class="bg-emerald-50 rounded-lg p-2 border-l-4 border-emerald-500 dark:bg-gray-800 dark:border-emerald-500">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700 font-medium dark:text-gray-400">总计 (底薪+加班)</span>
                            <span class="text-2xl font-bold text-emerald-600 dark:text-emerald-400" id="totalPay">0 元</span>
                        </div>
                    </div>
                    <div class="bg-violet-50 rounded-lg p-2 border-l-4 border-violet-500 dark:bg-gray-800 dark:border-violet-500">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700 font-medium dark:text-gray-400">小时工薪资</span>
                            <span class="text-2xl font-bold text-violet-600 dark:text-violet-400" id="workSalary">0 元</span>
                        </div>
                    </div>
                    <!-- 加G3薪资区域 - 根据G3工时是否为0决定是否显示 -->
                    <div id="g3Section" class="bg-amber-50 rounded-lg p-2 border-l-4 border-amber-500 dark:bg-gray-800 dark:border-amber-500">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-700 font-medium dark:text-gray-400">加G3薪资</span>
                            <span class="text-2xl font-bold text-amber-600 dark:text-amber-400" id="totalWithG3">0 元</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- 夜间模式切换按钮 -->
            <div class="mt-2 flex justify-center">
                <button id="theme-toggle" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 text-gray-800 rounded-lg transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-purple-500 dark:bg-gray-700 dark:hover:bg-gray-600 dark:text-gray-300 dark:focus:ring-purple-500">
                    <span id="theme-icon">🌙</span>
                    <span id="theme-text">切换到浅色模式</span>
                </button>
            </div>

        </div>
    </div>

    <!-- JavaScript 逻辑 -->
    <script>
        let formData = {
            baseSalary: 0,
            regularDays: 0,
            g1Hours: 0,
            g2Hours: 0,
            g3Hours: 0,
            hourlyRate: 0,
            g1Rate: 0,
            g2Rate: 0,
            g3Rate: 0,
            workHours: 0,
            workPrice: 0,
            subsidy: 0
        };

        let results = {
            overtimePay: 0,
            totalPay: 0,
            workSalary: 0,
            totalWithG3: 0
        };

        const STORAGE_KEY = 'salaryCalculatorData';

        // 检查系统偏好和本地存储的用户设置
        function getThemePreference() {
            // 优先检查本地存储
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme !== null) {
                return savedTheme;
            }
            // 如果没有本地存储，则检查系统偏好
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        // 应用主题
        function applyTheme(theme) {
            const body = document.body;
            const toggleButton = document.getElementById('theme-toggle');
            const icon = document.getElementById('theme-icon');
            const text = document.getElementById('theme-text');

            if (theme === 'dark') {
                // 添加深色模式类
                body.classList.add('dark');
                // 设置深色背景和文字颜色
                body.classList.add('bg-gray-900', 'text-gray-300');
                // 移除浅色背景类
                body.classList.remove('bg-gradient-to-br', 'from-purple-50', 'via-gray-50', 'to-purple-100');
                // 设置按钮样式为深色
                toggleButton.classList.replace('bg-gray-200', 'bg-gray-700');
                toggleButton.classList.replace('text-gray-800', 'text-gray-300');
                toggleButton.classList.replace('focus:ring-purple-500', 'focus:ring-purple-500');
                icon.textContent = '☀️';
                text.textContent = '切换到浅色模式';
            } else {
                // 移除深色模式类
                body.classList.remove('dark');
                // 恢复浅色背景和文字颜色
                body.classList.add('bg-gradient-to-br', 'from-purple-50', 'via-gray-50', 'to-purple-100');
                body.classList.remove('bg-gray-900', 'text-gray-300');
                // 恢复按钮样式为浅色
                toggleButton.classList.replace('bg-gray-700', 'bg-gray-200');
                toggleButton.classList.replace('text-gray-300', 'text-gray-800');
                toggleButton.classList.replace('focus:ring-purple-500', 'focus:ring-purple-500');
                icon.textContent = '🌙';
                text.textContent = '切换到深色模式';
            }
            // 保存到本地存储
            localStorage.setItem('theme', theme);
        }

        // 初始化主题
        function initTheme() {
            const theme = getThemePreference();
            applyTheme(theme);
        }

        // 切换主题
        function toggleTheme() {
            const currentTheme = document.body.classList.contains('dark') ? 'dark' : 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            applyTheme(newTheme);
        }

        // 监听系统主题变化
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            // 如果用户没有手动设置主题，则跟随系统
            if (!localStorage.getItem('theme')) {
                applyTheme(e.matches ? 'dark' : 'light');
            }
        });

        function saveData() {
            try {
                const dataToSave = { formData, timestamp: new Date().toISOString() };
                localStorage.setItem(STORAGE_KEY, JSON.stringify(dataToSave));
            } catch (error) {
                console.error('保存数据失败:', error);
            }
        }

        function loadData() {
            try {
                const savedData = localStorage.getItem(STORAGE_KEY);
                if (savedData) {
                    const parsedData = JSON.parse(savedData);
                    if (parsedData.formData) {
                        Object.assign(formData, parsedData.formData);
                        return true;
                    }
                }
            } catch (error) {
                console.error('读取数据失败:', error);
            }
            return false;
        }

        function calculate() {
            formData.baseSalary = parseFloat(document.getElementById('baseSalary').value) || 0;
            formData.regularDays = parseFloat(document.getElementById('regularDays').value) || 0;
            formData.g1Hours = parseFloat(document.getElementById('g1Hours').value) || 0;
            formData.g2Hours = parseFloat(document.getElementById('g2Hours').value) || 0;
            formData.g3Hours = parseFloat(document.getElementById('g3Hours').value) || 0;
            formData.workPrice = parseFloat(document.getElementById('workPrice').value) || 0;

            formData.hourlyRate = formData.baseSalary / (21.75 * 8);
            document.getElementById('hourlyRate').value = formData.hourlyRate.toFixed(2);

            formData.g1Rate = formData.hourlyRate * 1.5;
            document.getElementById('g1Rate').value = formData.g1Rate.toFixed(2);

            formData.g2Rate = formData.hourlyRate * 2;
            document.getElementById('g2Rate').value = formData.g2Rate.toFixed(2);

            formData.g3Rate = formData.hourlyRate * 3;
            document.getElementById('g3Rate').value = formData.g3Rate.toFixed(2);

            formData.workHours = formData.regularDays * 8 + formData.g1Hours + formData.g2Hours;
            document.getElementById('workHours').value = formData.workHours;

            const g1Pay = formData.g1Hours * formData.g1Rate;
            const g2Pay = formData.g2Hours * formData.g2Rate;
            const g3Pay = formData.g3Hours * formData.g3Rate;

            document.getElementById('g1Pay').value = g1Pay.toFixed(2);
            document.getElementById('g2Pay').value = g2Pay.toFixed(2);
            document.getElementById('g3Pay').value = g3Pay.toFixed(2);

            results.overtimePay = g1Pay + g2Pay + g3Pay;
            results.totalPay = formData.baseSalary + results.overtimePay;
            results.workSalary = (formData.workHours * formData.workPrice) + formData.subsidy;
            results.totalWithG3 = results.workSalary + g3Pay;

            document.getElementById('overtimePay').textContent = results.overtimePay.toFixed(2) + ' 元';
            document.getElementById('totalPay').textContent = results.totalPay.toFixed(2) + ' 元';
            document.getElementById('workSalary').textContent = results.workSalary.toFixed(2) + ' 元';
            document.getElementById('totalWithG3').textContent = results.totalWithG3.toFixed(2) + ' 元';

            // 根据G3工时是否为0来显示或隐藏加G3薪资部分
            const g3Section = document.getElementById('g3Section');
            if (formData.g3Hours === 0) {
                g3Section.style.display = 'none';
            } else {
                g3Section.style.display = 'block';
            }

            saveData();
        }

        window.onload = function() {
            initTheme(); // 初始化主题
            const dataLoaded = loadData();
            if (!dataLoaded) {
                console.log('未找到保存的数据，使用默认值');
            }

            document.getElementById('baseSalary').value = formData.baseSalary;
            document.getElementById('regularDays').value = formData.regularDays;
            document.getElementById('g1Hours').value = formData.g1Hours;
            document.getElementById('g2Hours').value = formData.g2Hours;
            document.getElementById('g3Hours').value = formData.g3Hours;
            document.getElementById('workPrice').value = formData.workPrice;

            calculate();
        };

        // 添加事件监听器到切换按钮
        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);

        window.addEventListener('beforeunload', saveData);
    </script>
</body>
</html>